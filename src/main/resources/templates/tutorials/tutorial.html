<!DOCTYPE html>
<html layout:decorate="~{layout}">

<head>
	<meta charset="UTF-8" />
</head>

<body>
	<section class="layout-content" layout:fragment="mybody">
		<div class="container">
			<h1>Tutorial Details</h1>
			<div class="content"> <strong>Title:</strong>
				<p th:text="${tutorial.title}"></p>
			</div>
			<div class="content"> <strong>Content Text:</strong>
				<p th:text="${tutorial.contentText}"></p>
			</div>
			<div class="content"> <strong>Creation Time:</strong>
				<p th:text="${tutorial.creationTime}"></p>
			</div>
			<div class="content" th:if="${tutorial.tutorialCategory != null}"> <strong>Category:</strong>
								<p th:text="${tutorial.tutorialCategory.categoryName}"></p>
							</div>
			<div class="container" th:if="${advertisement} != null"> 
			<div class="content" th:unless="${#strings.isEmpty(tutorial.videoUrl)}"> 
							<video width="640" height="360" th:src="@{${advertisement}}"  id="myvideo" type="video/mp4" autoplay>
							Your browser does not support the video tag.
							</video>
									</div>
			<div class="content" th:if="${#strings.isEmpty(tutorial.videoUrl)}"> 
									<p>No Video uploaded yet!</p>
						</div>	
			<div class="content" th:unless="${#strings.isEmpty(tutorial.videoUrl)}" > 
										<h3 id="adwarning">Advertisement</h3>
												</div>	
						<!--js to swap videos for ad-->
			<script th:inline="javascript">
				var myvid = document.getElementById('myvideo');
				var warning = document.getElementById('adwarning');
				var myvids = [
				  		[[${advertisement}]],
				  		[[${tutorial.videoUrl}]]
				  ];
				var activeVideo = 0;
			    myvid.addEventListener('ended',myHandler,false);
			    function myHandler(e) {
					if (adwarning.innerText === "Advertisement"){
						adwarning.innerText = ""
					} else{
						adwarning.innerText = "Advertisement"
					}
					if (myvid.hasAttribute("controls")) {
					     myvid.removeAttribute("controls")   
					  } else {
					     myvid.setAttribute("controls","controls")   
					  }
					activeVideo = (++activeVideo) % myvids.length;
					myvid.src = myvids[activeVideo];
					myvid.play();
			    }
			</script>
			</div> 
			
			<div class="container" th:unless="${advertisement} != null"> 
			<div class="content" th:unless="${#strings.isEmpty(tutorial.videoUrl)}"> 
									<video width="640" height="360" th:src="@{${tutorial.videoUrl}}" controls  id="myvideo" type="video/mp4" autoplay>
									Your browser does not support the video tag.
									</video>
											</div>
					<div class="content" th:if="${#strings.isEmpty(tutorial.videoUrl)}"> 
											<p>No Video uploaded yet!</p>
								</div>	
					</div> 
			
				
			<form th:action="@{/tutorial/uploadvideo/{id}(id=${tutorial.tutorialId})}" method="POST" enctype="multipart/form-data">
				<input type="file" id="video" name="video" accept="video/mp4" />
				<button type="submit" class="btn btn-primary btn-sm">Upload Video</button>
						</form>		
			<a th:unless="${#strings.isEmpty(tutorial.videoUrl)}" th:href="@{/tutorial/deletevideo/{id}(id=${tutorial.tutorialId})}" class="btn btn-danger">						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
						  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
						  <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
						</svg>Delete Video</a>
	
			<div class="content"> <strong>Likes:</strong>
				<p th:text="${tutorial.likes}"></p>
			</div>
			<div class="content"> <strong>Dislikes:</strong>
				<p th:text="${tutorial.dislikes}"></p>
			</div>
		</div>

		<form th:action="@{/comment/{id}/create(id=${tutorial.tutorialId})}" th:object="${comment}" method="POST">


			<div class="form-row">
				<div class="form-group col-md-6">
					<label for="commentTitle">Title</label>
					<input type="text" class="form-control" id="commentTitle" placeholder="commentTitle"
						th:field="*{commentTitle}"
						th:classappend="${#fields.hasErrors('commentTitle')} ? 'is-invalid'" />
					<div class="invalid-feedback">
						<span th:errors="*{commentTitle}"></span>
					</div>
				</div>
			</div>
			<div class="form-row">
				<div class="form-group col-md-6">
					<label for="content">content</label>
					<input type="text" class="form-control" id="content" placeholder="content" th:field="*{content}"
						th:classappend="${#fields.hasErrors('content')} ? 'is-invalid'" />
					<div class="invalid-feedback">
						<span th:errors="*{content}"></span>
					</div>
				</div>
			</div>

			<a th:href="@{/watchLater/save/{id}(id=${tutorial.tutorialId})}" class="btn btn-danger"> <svg
					xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bookmark"
					viewBox="0 0 16 16">
					<path
						d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1z" />
				</svg></a>

			<input type="hidden" id="commentId" th:field="*{commentId}" />
			<input type="hidden" id="creationDate" th:field="*{creationDate}" />
			
			<button type="submit" class="btn btn-primary btn-sm">Post Comment</button>
		</form>
		<table class="table table-striped table-bordered" style="width: 80%">
			<thead class="table-dark">
				<tr>
					<th> Title</th>
					<th> content</th>
					<th> creationDate</th>
				</tr>
			</thead>

			<tbody>
				<tr th:each="element: ${tutorial.attachedComments}">
					<td th:text="${element.commentTitle}"></td>
					<td th:text="${element.content}"></td>
					<td th:text="${element.creationDate}"></td>
				</tr>
			</tbody>
		</table>

	</section>
</body>

</html>